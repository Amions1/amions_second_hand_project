# 商品下架API文档

## 接口说明
**URL**: `/profiles/take_down/`  
**方法**: POST  
**功能**: 下架指定商品  

## 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | integer | 是 | 操作者用户ID |
| goods_id | integer | 是 | 要下架的商品ID |

## 响应格式

### 成功响应 (status: 200)
```json
{
    "status": "200",
    "msg": "商品下架成功",
    "data": {
        "goods_id": 1,
        "title": "商品标题",
        "publisher_id": 123,
        "operator_id": 456,
        "is_self_operation": true
    }
}
```

### 错误响应

#### 缺少参数 (status: 400)
```json
{
    "status": "400",
    "msg": "缺少必要参数",
    "data": []
}
```

#### 参数格式错误 (status: 400)
```json
{
    "status": "400", 
    "msg": "参数格式错误",
    "data": []
}
```

#### 数据不存在 (status: 404)
```json
{
    "status": "404",
    "msg": "用户或商品不存在",
    "data": []
}
```

#### 商品已下架 (status: 400)
```json
{
    "status": "400",
    "msg": "商品已经处于下架状态",
    "data": []
}
```

#### 权限不足 (status: 403)
```json
{
    "status": "403",
    "msg": "权限不足：只有更高权限的用户才能下架他人商品",
    "data": []
}
```

#### 服务器错误 (status: 500)
```json
{
    "status": "500",
    "msg": "服务器内部错误: 错误信息",
    "data": []
}
```

## 权限规则

### 角色等级
- 普通用户 (role=1)
- 管理员 (role=2)  
- 超级管理员 (role=3)

### 权限逻辑
1. **用户下架自己的商品**：✅ 允许
2. **高权限用户下架低权限用户商品**：✅ 允许
3. **同级或低权限用户下架高权限用户商品**：❌ 拒绝

### 示例场景
- 普通用户A可以下架自己发布的商品
- 管理员可以下架普通用户发布的商品
- 管理员不能下架超级管理员发布的商品
- 超级管理员可以下架任何人的商品

## 后续上架逻辑建议
根据 `is_self_operation` 字段判断：
- 如果为 `true`：用户可以自行上架该商品
- 如果为 `false`：需要原操作者或更高权限用户才能上架

## 注意事项
1. 商品下架后状态变为 `STATUS_OFF` (值为3)
2. 系统会记录操作日志（控制台输出）
3. 建议在商品模型中添加 `takedown_operator` 字段来持久化记录下架操作者